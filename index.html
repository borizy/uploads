<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerador de QR Code para PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
      * {
        box-sizing: border-box;
        font-family: "Segoe UI", sans-serif;
      }

      body {
        background-color: #f8fafc;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
      }

      .container {
        background: white;
        padding: 2.5rem;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        text-align: center;
        width: 100%;
        max-width: 400px;
      }

      h1 {
        color: #1e293b;
        margin-bottom: 1.5rem;
        font-size: 1.5rem;
      }

      input {
        width: 100%;
        padding: 14px;
        margin-bottom: 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 1rem;
        outline: none;
        transition: border-color 0.2s;
      }

      input:focus {
        border-color: #3b82f6;
      }

      button {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition:
          transform 0.1s,
          opacity 0.2s;
        margin-bottom: 10px;
      }

      button:active {
        transform: scale(0.98);
      }

      .btn-generate {
        background-color: #3b82f6;
        color: white;
      }

      .btn-pdf {
        background-color: #10b981;
        color: white;
        display: none; /* Escondido até gerar o QR */
      }

      #qrcode {
        margin: 2rem 0;
        display: flex;
        justify-content: center;
      }

      #qrcode img {
        border: 10px solid white;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .footer-text {
        font-size: 0.8rem;
        color: #94a3b8;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Gerador de QR Code</h1>

      <input
        type="url"
        id="urlInput"
        placeholder="Cole seu link aqui..."
        autocomplete="off"
      />

      <button class="btn-generate" onclick="generateQR()">Gerar QR Code</button>

      <div id="qrcode"></div>

      <button id="pdfBtn" class="btn-pdf" onclick="downloadPDF()">
        Salvar em PDF
      </button>

      <p class="footer-text">
        O PDF será gerado em tamanho A4 com o código centralizado.
      </p>
    </div>

    <script>
      const urlInput = document.getElementById("urlInput");
      const qrcodeContainer = document.getElementById("qrcode");
      const pdfBtn = document.getElementById("pdfBtn");

      function generateQR() {
        const url = urlInput.value.trim();

        if (!url) {
          alert("Por favor, insira um link válido.");
          return;
        }

        // Limpa QR anterior
        qrcodeContainer.innerHTML = "";

        // Cria o novo QR Code
        new QRCode(qrcodeContainer, {
          text: url,
          width: 256,
          height: 256,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H,
        });

        // Mostra o botão de PDF após o render
        setTimeout(() => {
          pdfBtn.style.display = "block";
        }, 200);
      }

      function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Tenta capturar a imagem gerada (QRCode.js gera uma <img> ou <canvas>)
        const qrImg = qrcodeContainer.querySelector("img");
        const qrCanvas = qrcodeContainer.querySelector("canvas");

        // Obtém o DataURL da imagem
        const imgData = qrImg ? qrImg.src : qrCanvas.toDataURL("image/png");

        if (!imgData) {
          alert("Erro ao capturar imagem do QR Code.");
          return;
        }

        // Título no PDF
        doc.setFont("helvetica", "bold");
        doc.setFontSize(22);
        doc.text("QR CODE GERADO", 105, 40, { align: "center" });

        // Desenha o QR Code centralizado (A4 tem 210mm de largura)
        // x=55, y=60, largura=100, altura=100
        doc.addImage(imgData, "PNG", 55, 60, 100, 100);

        // Adiciona o link abaixo para conferência
        doc.setFont("helvetica", "normal");
        doc.setFontSize(12);
        doc.setTextColor(100);
        const linkText =
          urlInput.value.length > 50
            ? urlInput.value.substring(0, 50) + "..."
            : urlInput.value;
        doc.text(linkText, 105, 170, { align: "center" });

        // Nome do arquivo baseado no link (opcional)
        doc.save("meu-qrcode.pdf");
      }
    </script>
  </body>
</html>
